"use strict";(self.webpackChunktask_manager_frontend=self.webpackChunktask_manager_frontend||[]).push([[929],{62:(e,s,t)=>{t.d(s,{A:()=>o});t(5043);var a=t(3216),i=t(1291),n=t(2532);const r=e=>n.Ez[e]||n.Ez[n.Rr.NOT_STARTED];var c=t(7081),l=t(579);const o=e=>{let{theme:s,task:t,demoMode:n=!1}=e;const o=(0,a.Zp)(),d=r(t.status),m=(0,c.NF)(t.reminders);return(0,l.jsxs)("div",{className:"task-card ".concat("dark"===s?"dark":""),onClick:()=>{n||o("/tasks/".concat(t.id,"/edit"))},children:[(0,l.jsx)("div",{className:"task-strip",style:{backgroundColor:d}}),(0,l.jsxs)("div",{className:"task-card-content",children:[(0,l.jsx)("i",{className:"bi ".concat("completed"===t.status?"bi-check-circle":"in-progress"===t.status?"bi-hourglass":"bi-ban"," status-icon"),style:{color:d}}),(0,l.jsx)("h5",{className:"task-title",style:{color:d},children:t.title}),(0,l.jsx)("p",{className:"task-description",children:t.description}),(0,l.jsxs)("div",{className:"task-metadata",children:[(0,l.jsxs)("div",{className:"task-metadata-item",children:[(0,l.jsx)("strong",{children:"Created"}),(0,l.jsx)("span",{children:(0,i.fw)(t.createdAt)})]}),(0,l.jsxs)("div",{className:"task-metadata-item",children:[(0,l.jsx)("strong",{children:"Deadline"}),(0,l.jsx)("span",{children:t.deadline?(0,i.fw)(t.deadline):"No deadline set"})]})]}),m&&(0,l.jsxs)("div",{className:"reminder-indicator",title:"Reminders: ".concat(m),children:[(0,l.jsx)("i",{className:"bi bi-clock"}),(0,l.jsx)("small",{children:m})]})]})]})}},8105:(e,s,t)=>{t.r(s),t.d(s,{default:()=>T});var a=t(2555),i=t(5043),n=t(3216),r=t(4505),c=t(8729),l=t(62),o=t(579);const d=e=>{let{setError:s,onClose:t}=e;const a=(0,n.Zp)(),[c,l]=(0,i.useState)(""),[d,m]=(0,i.useState)(!1),u=(0,i.useRef)(null);(0,i.useEffect)(()=>{u.current&&u.current.focus()},[]);const h=async()=>{if(!c.trim())return;m(!0),s(null);const e=await(0,r.Pr)(c);if(m(!1),!e.success)return void s(e.error);const i=e.data,n={title:i.title,description:i.description,status:i.status||"not-started",deadline:i.deadline,reminders:i.reminders||[]};t(),a("/tasks/new/edit",{state:{task:n}})};return(0,o.jsxs)("div",{className:"quick-mode",children:[(0,o.jsxs)("div",{className:"quick-mode-content",children:[(0,o.jsx)("label",{className:"form-label",children:"Describe your task:"}),(0,o.jsx)("textarea",{ref:u,className:"form-control",rows:4,value:c,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h())},placeholder:"E.g., 'Prepare project report by Friday 5PM with reminders 1 day and 1 hour before'",disabled:d}),(0,o.jsxs)("div",{className:"quick-mode-suggestions",children:[(0,o.jsx)("small",{children:"Try these:"}),["Schedule dentist appointment next Tuesday at 3pm","Plan weekend shopping with 1 day reminder","Prepare presentation for Monday with daily reminders"].map(e=>(0,o.jsx)("button",{className:"suggestion-chip",onClick:()=>l(e),disabled:d,children:e},e))]})]}),(0,o.jsxs)("div",{className:"modal-actions",children:[(0,o.jsx)("button",{className:"btn btn-secondary",onClick:t,disabled:d,children:"Cancel"}),(0,o.jsx)("button",{className:"btn btn-primary",onClick:h,disabled:!c.trim()||d,children:d?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner-border spinner-border-sm me-2"})," ","Generating..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("i",{className:"bi bi-magic me-2"})," Generate Task"]})})]})]})};var m=t(7081);const u=e=>{var s,t,a,i;let{msg:n,user:r,theme:c}=e;const l=r.avatar,d=((null===(s=r.firstName)||void 0===s||null===(t=s[0])||void 0===t?void 0:t.toUpperCase())||"")+((null===(a=r.lastName)||void 0===a||null===(i=a[0])||void 0===i?void 0:i.toUpperCase())||"")||"?";return(0,o.jsxs)("div",{className:"chat-message ".concat(n.role),children:[(0,o.jsx)("div",{className:"message-avatar",children:"user"===n.role?l?(0,o.jsx)("img",{src:l,alt:"User",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"}}):(0,o.jsx)("div",{style:{width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"dark"===c?"#ffffff":"#000000",color:"dark"===c?"#000000":"#ffffff",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.85rem"},children:d}):(0,o.jsx)("i",{className:"bi bi-robot"})}),(0,o.jsx)("div",{className:"message-content",children:(0,o.jsxs)("div",{className:"message-text",children:[(0,o.jsx)("div",{className:"message-text-content",children:(e=>{if(!e)return"";return e.split(/(\d+\.\s+[^\n]+)/g).map((e,s)=>{if(/^\d+\.\s+/.test(e)){const t=e.match(/^(\d+)\.\s+(.+)/);if(t)return(0,o.jsxs)("div",{style:{marginLeft:"0.5rem",marginTop:"0.25rem"},children:[(0,o.jsxs)("strong",{children:[t[1],"."]})," ",t[2]]},s)}const t=e.split(/(\*\*[^*]+\*\*)/g).map((e,s)=>e.startsWith("**")&&e.endsWith("**")?(0,o.jsx)("strong",{children:e.slice(2,-2)},s):e);return(0,o.jsx)("span",{children:t},s)})})(n.content)}),(0,o.jsxs)("div",{className:"message-time",children:[(e=>{const s=new Date(e),t=new Date,a=(t-s)/36e5;return a<24&&s.getDate()===t.getDate()?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):a<48&&s.getDate()===t.getDate()-1?"Yesterday ".concat(s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})):s.toLocaleDateString([],{month:"short",day:"numeric"})+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})(n.timestamp),"user"===n.role&&(0,o.jsx)("i",{className:"bi bi-check-all",style:{fontSize:"0.75rem"}})]})]})})]})};t(8421);var h=t(5090),x=t(6196),b=t(1291),p=t(2532);const j=e=>{let{theme:s,task:t,setTasks:n,isNewTask:c=!1,isChatPreview:l=!1,onSave:d=()=>{},onCancel:m=()=>{}}=e;const[u,j]=(0,i.useState)(c),[g,v]=(0,i.useState)(t.title),[N,k]=(0,i.useState)(t.description),[f,y]=(0,i.useState)(t.status),[w,C]=(0,i.useState)(t.deadline||null),[S,A]=(0,i.useState)(Array.isArray(t.reminders)?t.reminders:[]),[E,T]=(0,i.useState)(!1),[D,I]=(0,i.useState)(!1),_=(0,i.useRef)(null);(0,i.useEffect)(()=>{Array.isArray(t.reminders)&&t.reminders.length>0&&A(t.reminders)},[t.reminders]);const L=(0,i.useCallback)(()=>{v(t.title),k(t.description),y(t.status),C(t.deadline||null),A(Array.isArray(t.reminders)?t.reminders:[]),c?m(t.id):j(!1)},[t.title,t.description,t.status,t.deadline,t.reminders,c,m,t.id]);(0,i.useEffect)(()=>{if(l)return;const e=e=>{u&&_.current&&!_.current.contains(e.target)&&L()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[u,L,l]);const M=(e=>{switch(e){case"completed":return"#007a00";case"in-progress":return"#daa520";default:return"#a00000"}})(t.status),O=w&&new Date(w)>new Date,R=(()=>{if(!S||0===S.length)return null;const e=S.filter(e=>"daily"===e.type).length,s=S.filter(e=>"weekly"===e.type).length,t=S.filter(e=>"one-time"===e.type||!e.type).length,a=[];return e>0&&a.push("Daily (".concat(e,")")),s>0&&a.push("Weekly (".concat(s,")")),t>0&&a.push("One-time (".concat(t,")")),a.length>0?a.join(", "):null})();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{ref:_,className:"task-card ".concat("dark"===s?"dark":""," ").concat(D?"loading":""," ").concat(c?"new-task":""," ").concat(l?"chat-preview":""),onClick:()=>!u&&!l&&j(!0),children:[(0,o.jsx)("div",{className:"task-strip",style:{backgroundColor:M}}),(0,o.jsxs)("div",{className:"task-card-content",children:[!u&&(0,o.jsx)("i",{className:"bi ".concat("completed"===t.status?"bi-check-circle":"in-progress"===t.status?"bi-hourglass":"bi-ban"," status-icon"),style:{color:M}}),u?(0,o.jsxs)("div",{className:"task-form-grid",children:[(0,o.jsxs)("div",{className:"task-form-group full-width",children:[(0,o.jsx)("label",{className:"form-label",children:"Title"}),(0,o.jsx)("input",{type:"text",className:"form-control",value:g,onChange:e=>v(e.target.value),placeholder:"Enter task title..."})]}),(0,o.jsxs)("div",{className:"task-form-group full-width",children:[(0,o.jsx)("label",{className:"form-label",children:"Description"}),(0,o.jsx)("textarea",{className:"form-control",rows:3,value:N,onChange:e=>k(e.target.value),placeholder:"Enter task description..."})]}),(0,o.jsxs)("div",{className:"task-form-group",children:[(0,o.jsx)("label",{className:"form-label",children:"Status"}),(0,o.jsxs)("select",{className:"form-select",value:f,onChange:e=>y(e.target.value),children:[(0,o.jsx)("option",{value:"not-started",children:"Not Started"}),(0,o.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,o.jsx)("option",{value:"completed",children:"Completed"})]})]}),(0,o.jsxs)("div",{className:"task-form-group",children:[(0,o.jsx)("label",{className:"form-label",children:"Deadline"}),(0,o.jsx)("input",{type:"datetime-local",className:"form-control",value:w?(0,b.wM)(w):"",onChange:e=>C(e.target.value)})]}),O&&(0,o.jsx)("div",{className:"task-form-group full-width",children:(0,o.jsx)(x.A,{tempDeadline:w,tempReminders:S,setTempReminders:A,theme:s,ALL_INTERVALS:p.Ym})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h5",{className:"task-title",style:{color:M},children:g}),(0,o.jsx)("p",{className:"task-description",children:N})]}),(0,o.jsxs)("div",{className:"task-metadata",children:[(0,o.jsxs)("div",{className:"task-metadata-item",children:[(0,o.jsx)("strong",{children:"Created"}),(0,o.jsx)("span",{children:(0,b.fw)(t.createdAt)})]}),(0,o.jsxs)("div",{className:"task-metadata-item",children:[(0,o.jsx)("strong",{children:"Deadline"}),(0,o.jsx)("span",{children:t.deadline?(0,b.fw)(t.deadline):"No deadline set"})]})]}),u&&(0,o.jsxs)("div",{className:"task-actions",children:[!c&&(0,o.jsx)("button",{className:"btn ".concat("dark"===s?"btn-outline-danger":"btn-secondary"),onClick:e=>{e.stopPropagation(),T(!0)},disabled:D,children:D?"Deleting...":"Delete"}),(0,o.jsx)("button",{className:"btn ".concat("dark"===s?"btn-outline-light":"btn-dark"),onClick:e=>{e.stopPropagation(),(async()=>{if(!g.trim()||!N.trim())return;if(I(!0),!(g!==t.title||N!==t.description||f!==t.status||w!==t.deadline||JSON.stringify(S)!==JSON.stringify(t.reminders))&&!c)return j(!1),void I(!1);const e=new Date,s=w?new Date(w):null,i=s&&s>e?(s-e)/36e5:0,l=i>0?(e=>{const s=e.some(e=>"daily"===e.type),t=e.some(e=>"weekly"===e.type);let a=e.filter(e=>("one-time"===e.type||!e.type)&&e.remindBefore<=i);if(s&&i>0){const e=Math.floor(i/24);for(let s=1;s<=e;s++)a.push({remindBefore:24*s,sent:!1,type:"daily",dayNumber:s})}if(t&&i>0){const e=Math.floor(i/168);for(let s=1;s<=e;s++)a.push({remindBefore:24*s*7,sent:!1,type:"weekly",weekNumber:s})}return a})(S):[],o={title:g.trim(),description:N.trim(),status:f,deadline:w?s.toISOString():null,reminders:l};try{if(c)d((0,a.A)((0,a.A)({},t),o));else{const e=await(0,r.lC)(t.id,o);n(s=>s.map(s=>s.id===e.data.id?e.data:s)),j(!1)}}catch(m){console.error("Error updating task:",m)}finally{I(!1)}})()},disabled:!g.trim()||!N.trim()||D,children:D?"Saving...":"Save"})]}),!u&&R&&(0,o.jsxs)("div",{className:"reminder-indicator",title:"Reminders: ".concat(R),children:[(0,o.jsx)("i",{className:"bi bi-clock"}),(0,o.jsx)("small",{children:R})]})]})]}),(0,o.jsx)(h.A,{theme:s,show:E,title:"Delete Task",message:"Are you sure you want to delete this task? This action cannot be undone.",onConfirm:async()=>{I(!0);try{await(0,r.vq)(t.id),n(e=>e.filter(e=>e.id!==t.id)),T(!1)}catch(e){console.error("Error deleting task:",e)}finally{I(!1),T(!1)}},onCancel:()=>T(!1)})]})},g=p.d5.AI_CHAT_HISTORY,v=e=>{let{task:s,theme:t}=e;const[n,r]=(0,i.useState)(!1);return(0,o.jsxs)("div",{className:"task-preview-badge",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[(0,o.jsxs)("div",{className:"badge-compact",children:[(0,o.jsxs)("div",{className:"badge-info",children:[(0,o.jsx)("div",{className:"badge-status",children:s.confirmed?"delete"===s.action?"Deleted":"create"===s.action?"Created":"Updated":s.cancelled?"Cancelled":"delete"===s.action?"Delete Request":"create"===s.action?"New Task":"Update Request"}),(0,o.jsx)("div",{className:"badge-title",children:s.title})]}),(0,o.jsx)("div",{className:"badge-expand-hint",children:(0,o.jsx)("i",{className:"bi bi-chevron-".concat(n?"down":"right")})})]}),n&&(0,o.jsx)("div",{className:"badge-expanded-content",children:(0,o.jsx)(j,{theme:t,task:(0,a.A)((0,a.A)({},s),{},{title:s.title||"",description:s.description||"",reminders:Array.isArray(s.reminders)?s.reminders:[]}),isNewTask:!1,isChatPreview:!0,isHistoryPreview:!0,onSave:()=>{},onCancel:()=>{}})})]})},N=e=>{let{task:s,theme:t}=e;return(0,o.jsx)("div",{className:"delete-action-badge",children:(0,o.jsxs)("div",{className:"delete-info",children:[(0,o.jsx)("div",{className:"delete-status",children:s.confirmed?"Deleted":s.cancelled?"Delete Cancelled":"Delete Request"}),(0,o.jsx)("div",{className:"delete-title",children:s.title})]})})},k=e=>{let{setError:s,theme:t,refreshTasks:n}=e;const{user:l}=(0,c.A)(),[d,h]=(0,i.useState)(()=>{try{const e=localStorage.getItem(g);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading chat history:",e),[]}}),[x,b]=(0,i.useState)(""),[p,k]=(0,i.useState)(!1),[f,y]=(0,i.useState)(null),w=(0,i.useRef)(null),C=(0,i.useRef)(null);(0,i.useEffect)(()=>{C.current&&C.current.focus()},[]),(0,i.useEffect)(()=>{w.current&&w.current.scrollIntoView({behavior:"smooth"})},[d,f]),(0,i.useEffect)(()=>{try{localStorage.setItem(g,JSON.stringify(d))}catch(e){console.error("Error saving chat history:",e)}},[d]);const S=async()=>{if(!x.trim())return;const e={role:"user",content:x.trim(),timestamp:(new Date).toISOString()};f&&(h(e=>[...e,{role:"assistant",content:"",timestamp:(new Date).toISOString(),preview:f}]),y(null)),h(s=>[...s,e]),b(""),k(!0),s(null),setTimeout(()=>{C.current&&C.current.focus()},100);const t=d.filter(e=>e.content).map(e=>({role:e.role,content:e.content})),i=await(0,r.gQ)(e.content,t);if(k(!1),!i.success)return void s(i.error);const{reply:n,previewUpdate:c}=i.data;c&&c.reminders&&(c.reminders=(0,m.ZW)(c.reminders,c.deadline)),h(e=>[...e,{role:"assistant",content:n,timestamp:(new Date).toISOString()}]),c&&y((0,a.A)((0,a.A)({},c),{},{_aiSuggested:!0,isUpdate:"update"===c.action||"delete"===c.action,isNewTask:"create"===c.action||c.isNewTask,createdAt:c.createdAt||(new Date).toISOString(),updatedAt:(new Date).toISOString()}))},A=async e=>{try{if(!e)return;k(!0),s(null);const t=(0,m.ZW)(e.reminders||[],e.deadline);let i="";"delete"===e.action?(await(0,r.vq)(e.id),i='Successfully deleted "'.concat(e.title,'"')):"create"===e.action?(await(0,r.UT)({title:e.title,description:e.description,status:e.status,deadline:e.deadline,reminders:t}),i='Successfully created "'.concat(e.title,'"')):(await(0,r.lC)(e.id,{title:e.title,description:e.description,status:e.status,deadline:e.deadline,reminders:t}),i='Successfully updated "'.concat(e.title,'"')),await n(),h(s=>[...s,{role:"assistant",content:"",timestamp:(new Date).toISOString(),preview:(0,a.A)((0,a.A)({},e),{},{confirmed:!0})},{role:"assistant",content:i,timestamp:(new Date).toISOString()}]),y(null)}catch(t){console.error("Error applying AI update:",t),s("Failed to apply update.")}finally{k(!1)}},E=()=>{f&&(h(e=>[...e,{role:"assistant",content:"",timestamp:(new Date).toISOString(),preview:(0,a.A)((0,a.A)({},f),{},{cancelled:!0})}]),y(null))};return(0,o.jsxs)("div",{className:"chat-mode",children:[(0,o.jsxs)("div",{className:"chat-messages",children:[0!==d.length||f?(0,o.jsxs)(o.Fragment,{children:[d.map((e,s)=>{if(e.preview){const a=e.preview;return(0,o.jsxs)("div",{className:"chat-message assistant",children:[(0,o.jsx)("div",{className:"message-avatar",children:(0,o.jsx)("i",{className:"bi bi-robot"})}),(0,o.jsx)("div",{className:"message-content",children:"delete"===a.action?(0,o.jsx)(N,{task:a,theme:t}):(0,o.jsx)(v,{task:a,theme:t})})]},s)}return e.content?(0,o.jsx)(u,{msg:e,user:l,theme:t},s):null}),f&&(0,o.jsxs)("div",{className:"chat-message assistant",children:[(0,o.jsx)("div",{className:"message-avatar",children:(0,o.jsx)("i",{className:"bi bi-robot"})}),(0,o.jsx)("div",{className:"message-content w-100",children:"delete"===f.action?(0,o.jsxs)("div",{className:"active-delete-preview",children:[(0,o.jsx)("div",{className:"delete-preview-header",children:(0,o.jsxs)("span",{className:"delete-text",children:["Confirm deletion of"," ",(0,o.jsxs)("strong",{children:['"',f.title,'"']}),"?"]})}),(0,o.jsxs)("div",{className:"delete-preview-actions",children:[(0,o.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>A(f),disabled:p,"aria-label":"Confirm delete task",children:p?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner-border spinner-border-sm me-1"}),"Deleting..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("i",{className:"bi bi-trash me-1"}),"Delete"]})}),(0,o.jsxs)("button",{className:"btn btn-secondary btn-sm",onClick:E,disabled:p,"aria-label":"Cancel delete",children:[(0,o.jsx)("i",{className:"bi bi-x-lg me-1"}),"Cancel"]})]})]}):(0,o.jsx)(j,{theme:t,task:(0,a.A)((0,a.A)({},f),{},{title:f.title||"",description:f.description||"",reminders:Array.isArray(f.reminders)?f.reminders:[]}),isNewTask:!0,isChatPreview:!0,onSave:A,onCancel:E})})]})]}):(0,o.jsxs)("div",{className:"chat-empty-state",children:[(0,o.jsx)("i",{className:"bi bi-chat-heart"}),(0,o.jsx)("p",{children:"Start a conversation with AI"}),(0,o.jsx)("small",{children:"Ask questions or describe your task step by step"})]}),p&&(0,o.jsxs)("div",{className:"chat-message assistant",children:[(0,o.jsx)("div",{className:"message-avatar",children:(0,o.jsx)("i",{className:"bi bi-robot"})}),(0,o.jsx)("div",{className:"message-content",children:(0,o.jsxs)("div",{className:"typing-indicator",children:[(0,o.jsx)("span",{}),(0,o.jsx)("span",{}),(0,o.jsx)("span",{})]})})]}),(0,o.jsx)("div",{ref:w})]}),(0,o.jsxs)("div",{className:"chat-input-container",children:[(0,o.jsx)("input",{ref:C,type:"text",className:"form-control",value:x,onChange:e=>b(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())},placeholder:"Type your message...",disabled:p,"aria-label":"Type your message to AI assistant"}),(0,o.jsx)("button",{className:"send-button",onClick:S,disabled:!x.trim()||p,"aria-label":"Send message",children:(0,o.jsx)("i",{className:"bi bi-send-fill"})})]}),(0,o.jsxs)("div",{className:"chat-actions",children:[(0,o.jsxs)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>{h([]),s(null),y(null);try{localStorage.removeItem(g)}catch(e){console.error("Error clearing chat history:",e)}},disabled:p||0===d.length,"aria-label":"Clear chat history",children:[(0,o.jsx)("i",{className:"bi bi-arrow-clockwise me-1"})," Clear Chat"]}),(0,o.jsxs)("button",{className:"btn btn-sm btn-primary",onClick:async()=>{if(0===d.filter(e=>e.content).length)return void s("No conversation found to generate task from");k(!0),s(null),f&&(h(e=>[...e,{role:"assistant",content:"",timestamp:(new Date).toISOString(),preview:f}]),y(null));const e=d.filter(e=>e.content).map(e=>"".concat("user"===e.role?"User":"Assistant",": ").concat(e.content)).join("\n"),t="Based on this conversation, create a task:\n\n".concat(e,"\n\nCreate a detailed task with appropriate deadline and reminders."),i=await(0,r.Pr)(t);if(k(!1),!i.success)return void s(i.error);const n=i.data;y((0,a.A)((0,a.A)({},n),{},{id:"temp-".concat(Date.now()),status:n.status||"not-started",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),priority:1,_aiSuggested:!0,isNewTask:!0,action:"create"}))},disabled:p||0===d.filter(e=>e.content).length,"aria-label":"Generate task from conversation",children:[(0,o.jsx)("i",{className:"bi bi-magic me-1"})," Generate Task"]})]})]})},f=e=>{let{theme:s,task:t,onClose:a,onSave:i}=e;return(0,o.jsx)("div",{className:"ai-preview-overlay",onClick:a,children:(0,o.jsxs)("div",{className:"ai-preview-modal",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("h5",{className:"mb-3",children:[(0,o.jsx)("i",{className:"bi bi-eye"})," Task Preview"]}),(0,o.jsx)(j,{theme:s,task:t,isNewTask:!0,onSave:i,onCancel:a}),(0,o.jsx)("div",{className:"text-end mt-2",children:(0,o.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"Cancel"})})]})})},y=e=>{let{show:s,onClose:t,onTaskGenerated:a,theme:n,refreshTasks:r,isWidget:c=!1,showOptions:l=!1,setShowOptions:m=null,chatMode:u=null,onModeChange:h=null,widgetSize:x="medium",onSizeChange:b=null,optionsRef:p=null}=e;const[j,g]=(0,i.useState)("quick"),[v,N]=(0,i.useState)(null),[y,w]=(0,i.useState)(null),[C,S]=(0,i.useState)(!1),A=(0,i.useRef)(0);(0,i.useEffect)(()=>{try{const e=localStorage.getItem("ai_chat_mode");!e||"quick"!==e&&"chat"!==e||g(e)}catch(y){console.error("Error loading chat mode:",y)}},[]),(0,i.useEffect)(()=>{try{localStorage.setItem("ai_chat_mode",j)}catch(y){console.error("Error saving chat mode:",y)}},[j]);const E=(0,i.useCallback)(()=>{S(!0),setTimeout(()=>{S(!1),w(null),N(null),t()},250)},[t]);(0,i.useEffect)(()=>{const e=e=>{"Escape"!==e.key||!s||v||c||E()};return s&&!c&&(A.current=window.pageYOffset,document.addEventListener("keydown",e),document.body.style.overflow="hidden",document.body.style.touchAction="none",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top="-".concat(A.current,"px")),()=>{c||(document.removeEventListener("keydown",e),document.body.style.overflow="",document.body.style.touchAction="",document.body.style.position="",document.body.style.width="",document.body.style.top="",window.scrollTo(0,A.current))}},[s,v,E,c]);return s||C?c?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"ai-mode-selector",children:[(0,o.jsxs)("button",{className:"mode-button ".concat("quick"===j?"active":""),onClick:()=>g("quick"),"aria-pressed":"quick"===j,"aria-label":"Switch to Quick Mode - Generate tasks quickly with a simple prompt",children:[(0,o.jsx)("i",{className:"bi bi-lightning-charge","aria-hidden":"true"})," Quick"]}),(0,o.jsxs)("button",{className:"mode-button ".concat("chat"===j?"active":""),onClick:()=>g("chat"),"aria-pressed":"chat"===j,"aria-label":"Switch to Chat Mode - Have a conversation to refine your task",children:[(0,o.jsx)("i",{className:"bi bi-chat-dots","aria-hidden":"true"})," Chat"]})]}),y&&(0,o.jsxs)("div",{className:"error-banner",children:[(0,o.jsx)("i",{className:"bi bi-exclamation-triangle"})," ",y,(0,o.jsx)("button",{onClick:()=>w(null),style:{marginLeft:"auto",background:"none",border:"none",color:"inherit",cursor:"pointer",padding:"0 4px"},"aria-label":"Dismiss error",children:(0,o.jsx)("i",{className:"bi bi-x-lg"})})]}),"quick"===j?(0,o.jsx)(d,{setError:w,setPreviewTask:N,onTaskGenerated:a,onClose:E,theme:n}):(0,o.jsx)(k,{setError:w,theme:n,refreshTasks:r,onClose:E},j),v&&(0,o.jsx)(f,{theme:n,task:v,onClose:()=>N(null),onSave:e=>{a(e),N(null),E()}})]}):(0,o.jsxs)("div",{className:"ai-modal-overlay ".concat(C?"closing":""),onClick:e=>{e.target!==e.currentTarget||v||c||E()},children:[(0,o.jsxs)("div",{className:"ai-modal-content ".concat("dark"===n?"dark-mode":""," ").concat(C?"closing":""),onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"ai-modal-header",children:[(0,o.jsxs)("h3",{children:[(0,o.jsx)("i",{className:"bi bi-robot"})," AI Task Assistant"]}),(0,o.jsxs)("div",{className:"header-options-wrapper",children:[m&&(0,o.jsxs)("div",{className:"floating-options",ref:p,children:[(0,o.jsx)("button",{className:"close-button",onClick:()=>m(!l),"aria-label":"Options",style:{marginRight:"8px"},children:(0,o.jsx)("i",{className:"bi bi-three-dots-vertical"})}),l&&(0,o.jsxs)("div",{className:"options-dropdown ".concat("dark"===n?"dark":""),children:[(0,o.jsx)("div",{className:"options-header",children:"Chat Mode"}),(0,o.jsxs)("button",{className:"option-item ".concat("widget"===u?"active":""),onClick:()=>h("widget"),children:[(0,o.jsx)("i",{className:"bi bi-window"}),(0,o.jsx)("span",{children:"Floating Widget"}),"widget"===u&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),(0,o.jsxs)("button",{className:"option-item ".concat("drawer"===u?"active":""),onClick:()=>h("drawer"),children:[(0,o.jsx)("i",{className:"bi bi-layout-sidebar"}),(0,o.jsx)("span",{children:"Sidebar Drawer"}),"drawer"===u&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),b&&window.innerWidth>768&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"options-divider"}),(0,o.jsx)("div",{className:"options-header",children:"Window Size"}),(0,o.jsxs)("button",{className:"option-item ".concat("small"===x?"active":""),onClick:()=>b("small"),children:[(0,o.jsx)("i",{className:"bi bi-phone"}),(0,o.jsx)("span",{children:"Small"}),"small"===x&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),(0,o.jsxs)("button",{className:"option-item ".concat("medium"===x?"active":""),onClick:()=>b("medium"),children:[(0,o.jsx)("i",{className:"bi bi-tablet"}),(0,o.jsx)("span",{children:"Medium"}),"medium"===x&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),(0,o.jsxs)("button",{className:"option-item ".concat("large"===x?"active":""),onClick:()=>b("large"),children:[(0,o.jsx)("i",{className:"bi bi-laptop"}),(0,o.jsx)("span",{children:"Large"}),"large"===x&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),(0,o.jsxs)("button",{className:"option-item ".concat("fullscreen"===x?"active":""),onClick:()=>b("fullscreen"),children:[(0,o.jsx)("i",{className:"bi bi-arrows-fullscreen"}),(0,o.jsx)("span",{children:"Fullscreen"}),"fullscreen"===x&&(0,o.jsx)("i",{className:"bi bi-check2"})]})]})]})]}),(0,o.jsx)("button",{className:"close-button",onClick:E,"aria-label":"Close AI Assistant",children:(0,o.jsx)("i",{className:"bi bi-x-lg"})})]})]}),(0,o.jsxs)("div",{className:"ai-mode-selector",children:[(0,o.jsxs)("button",{className:"mode-button ".concat("quick"===j?"active":""),onClick:()=>g("quick"),"aria-pressed":"quick"===j,children:[(0,o.jsx)("i",{className:"bi bi-lightning-charge"})," Quick"]}),(0,o.jsxs)("button",{className:"mode-button ".concat("chat"===j?"active":""),onClick:()=>g("chat"),"aria-pressed":"chat"===j,children:[(0,o.jsx)("i",{className:"bi bi-chat-dots"})," Chat"]})]}),y&&(0,o.jsxs)("div",{className:"error-banner",children:[(0,o.jsx)("i",{className:"bi bi-exclamation-triangle"})," ",y,(0,o.jsx)("button",{onClick:()=>w(null),style:{marginLeft:"auto",background:"none",border:"none",color:"inherit",cursor:"pointer",padding:"0 4px"},"aria-label":"Dismiss error",children:(0,o.jsx)("i",{className:"bi bi-x-lg"})})]}),"quick"===j?(0,o.jsx)(d,{setError:w,setPreviewTask:N,onTaskGenerated:a,onClose:E,theme:n}):(0,o.jsx)(k,{setError:w,theme:n,refreshTasks:r,onClose:E},j)]}),v&&(0,o.jsx)(f,{theme:n,task:v,onClose:()=>N(null),onSave:e=>{a(e),N(null),E()}})]}):null},w=e=>{let{theme:s,onTaskGenerated:t,refreshTasks:a}=e;const[n,r]=(0,i.useState)(!1),[c,l]=(0,i.useState)(!1),[d,m]=(0,i.useState)(()=>localStorage.getItem("ai_chat_ui_mode")||"widget"),[u,h]=(0,i.useState)(()=>localStorage.getItem("chat_widget_size")||"medium"),[x,b]=(0,i.useState)(()=>{const e=localStorage.getItem("chat_button_position");return e?JSON.parse(e):{x:window.innerWidth-90,y:window.innerHeight-90}}),[p,j]=(0,i.useState)(!1),[g,v]=(0,i.useState)(!1),[N,k]=(0,i.useState)({x:0,y:0}),f=(0,i.useRef)(null),w=(0,i.useRef)(null);(0,i.useEffect)(()=>{localStorage.setItem("chat_button_position",JSON.stringify(x))},[x]),(0,i.useEffect)(()=>{localStorage.setItem("chat_widget_size",u)},[u]),(0,i.useEffect)(()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&l(!1)};if(c)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[c]);const C=(0,i.useCallback)((e,s)=>{const t=window.innerWidth,a=window.innerHeight,i=24,n=[{x:i,y:i},{x:t-60-i,y:i},{x:i,y:a-60-i},{x:t-60-i,y:a-60-i}];let r=n[0],c=Math.hypot(e-n[0].x,s-n[0].y);return n.forEach(t=>{const a=Math.hypot(e-t.x,s-t.y);a<c&&(c=a,r=t)}),{x:r.x,y:r.y}},[]),S=(0,i.useCallback)(e=>{if(!p)return;const s=Math.abs(e.clientX-N.x-x.x),t=Math.abs(e.clientY-N.y-x.y);(s>5||t>5)&&v(!0);const a=e.clientX-N.x,i=e.clientY-N.y;b({x:a,y:i})},[p,N,x]),A=(0,i.useCallback)(e=>{if(p){if(g){const e=C(x.x,x.y);b(e)}j(!1),g||(e.stopPropagation(),r(!0)),setTimeout(()=>v(!1),100)}},[p,g,x,C]);(0,i.useEffect)(()=>{if(p)return document.addEventListener("mousemove",S),document.addEventListener("mouseup",A),()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",A)}},[p,S,A]);const E=(0,i.useCallback)(e=>{if(!p)return;e.preventDefault();const s=e.touches[0],t=Math.abs(s.clientX-N.x-x.x),a=Math.abs(s.clientY-N.y-x.y);(t>5||a>5)&&v(!0);const i=s.clientX-N.x,n=s.clientY-N.y;b({x:i,y:n})},[p,N,x]),T=(0,i.useCallback)(e=>{if(p){if(g){const e=C(x.x,x.y);b(e)}j(!1),g||(e.preventDefault(),r(!0)),setTimeout(()=>v(!1),100)}},[p,g,x,C]);(0,i.useEffect)(()=>{if(p)return document.addEventListener("touchmove",E,{passive:!1}),document.addEventListener("touchend",T),()=>{document.removeEventListener("touchmove",E),document.removeEventListener("touchend",T)}},[p,E,T]);const D=()=>{r(!1),l(!1)},I=e=>{m(e),localStorage.setItem("ai_chat_ui_mode",e),l(!1)},_=e=>{h(e),l(!1)};return(0,o.jsxs)(o.Fragment,{children:[!n&&(0,o.jsx)("button",{ref:f,className:"floating-chat-button ".concat("dark"===s?"dark":""," ").concat(p?"dragging":""),style:{left:"".concat(x.x,"px"),top:"".concat(x.y,"px")},onClick:e=>{p||g||r(!0)},onMouseDown:e=>{e.preventDefault(),j(!0),v(!1);const s=f.current.getBoundingClientRect();k({x:e.clientX-s.left,y:e.clientY-s.top})},onTouchStart:e=>{const s=e.touches[0];j(!0),v(!1);const t=f.current.getBoundingClientRect();k({x:s.clientX-t.left,y:s.clientY-t.top})},"aria-label":"Open AI Assistant chat - Drag to reposition",children:(0,o.jsx)("i",{className:"bi bi-cloud-fill","aria-hidden":"true"})}),n&&"drawer"===d&&(0,o.jsx)(y,{show:!0,onClose:D,onTaskGenerated:t,theme:s,refreshTasks:a,isWidget:!1,showOptions:c,setShowOptions:l,chatMode:d,onModeChange:I,widgetSize:u,onSizeChange:_,optionsRef:w}),n&&"widget"===d&&(0,o.jsxs)("div",{className:"floating-chat-modal ".concat("dark"===s?"dark":""," ").concat("fullscreen"===u?"fullscreen":""),style:(()=>{const e={small:{width:"320px",height:"450px"},medium:{width:"400px",height:"600px"},large:{width:"500px",height:"700px"},fullscreen:{width:"calc(100vw - 48px)",height:"calc(100vh - 48px)",maxWidth:"1200px",maxHeight:"900px"}};return e[u]||e.medium})(),children:[(0,o.jsxs)("div",{className:"floating-modal-header",children:[(0,o.jsxs)("div",{className:"modal-header-title",children:[(0,o.jsx)("i",{className:"bi bi-robot"}),(0,o.jsx)("span",{children:"AI Assistant"})]}),(0,o.jsxs)("div",{className:"modal-header-actions",children:[(0,o.jsxs)("div",{className:"floating-options",ref:w,children:[(0,o.jsx)("button",{className:"header-icon-button",onClick:()=>l(!c),"aria-label":"Options",children:(0,o.jsx)("i",{className:"bi bi-three-dots-vertical"})}),c&&(0,o.jsxs)("div",{className:"options-dropdown ".concat("dark"===s?"dark":""),children:[(0,o.jsx)("div",{className:"options-header",children:"Chat Mode"}),(0,o.jsxs)("button",{className:"option-item ".concat("widget"===d?"active":""),onClick:()=>I("widget"),children:[(0,o.jsx)("i",{className:"bi bi-window"}),(0,o.jsx)("span",{children:"Floating Widget"}),"widget"===d&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),(0,o.jsxs)("button",{className:"option-item ".concat("drawer"===d?"active":""),onClick:()=>I("drawer"),children:[(0,o.jsx)("i",{className:"bi bi-layout-sidebar"}),(0,o.jsx)("span",{children:"Sidebar Drawer"}),"drawer"===d&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),window.innerWidth>768&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"options-divider"}),(0,o.jsx)("div",{className:"options-header",children:"Window Size"}),(0,o.jsxs)("button",{className:"option-item ".concat("small"===u?"active":""),onClick:()=>_("small"),children:[(0,o.jsx)("i",{className:"bi bi-phone"}),(0,o.jsx)("span",{children:"Small"}),"small"===u&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),(0,o.jsxs)("button",{className:"option-item ".concat("medium"===u?"active":""),onClick:()=>_("medium"),children:[(0,o.jsx)("i",{className:"bi bi-tablet"}),(0,o.jsx)("span",{children:"Medium"}),"medium"===u&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),(0,o.jsxs)("button",{className:"option-item ".concat("large"===u?"active":""),onClick:()=>_("large"),children:[(0,o.jsx)("i",{className:"bi bi-laptop"}),(0,o.jsx)("span",{children:"Large"}),"large"===u&&(0,o.jsx)("i",{className:"bi bi-check2"})]}),(0,o.jsxs)("button",{className:"option-item ".concat("fullscreen"===u?"active":""),onClick:()=>_("fullscreen"),children:[(0,o.jsx)("i",{className:"bi bi-arrows-fullscreen"}),(0,o.jsx)("span",{children:"Fullscreen"}),"fullscreen"===u&&(0,o.jsx)("i",{className:"bi bi-check2"})]})]})]})]}),(0,o.jsx)("button",{className:"header-icon-button",onClick:D,"aria-label":"Close",children:(0,o.jsx)("i",{className:"bi bi-x-lg"})})]})]}),(0,o.jsx)("div",{className:"floating-modal-body",children:(0,o.jsx)(y,{show:!0,onClose:D,onTaskGenerated:t,theme:s,refreshTasks:a,isWidget:!0})})]}),p&&(0,o.jsx)("div",{className:"drag-overlay"})]})};var C=t(3585),S=t(1648),A=t(1024);const E=e=>{let{task:s,theme:t}=e;const{attributes:i,listeners:n,setNodeRef:r,transform:c,transition:d,isDragging:m}=(0,S.gl)({id:s.id,transition:{duration:250,easing:"cubic-bezier(0.25, 0.8, 0.25, 1)"}}),u={transform:A.Ks.Transform.toString(c),transition:d||"transform 250ms cubic-bezier(0.25, 0.8, 0.25, 1)",opacity:m?0:1,cursor:"grab",touchAction:"manipulation"};return(0,o.jsx)("div",(0,a.A)((0,a.A)((0,a.A)({ref:r,style:u},i),n),{},{children:(0,o.jsx)(l.A,{theme:t,task:s})}))},T=e=>{let{theme:s}=e;const t=(0,n.Zp)(),{user:d,logout:m}=(0,c.A)(),[u,h]=(0,i.useState)(null),[x,b]=(0,i.useState)(!1),[p,j]=(0,i.useState)(null),[g,v]=(0,i.useState)(()=>localStorage.getItem("ai_chat_ui_mode")||"drawer"),N=(0,C.FR)((0,C.MS)(C.cA,{activationConstraint:{distance:10}}),(0,C.MS)(C.IG,{activationConstraint:{delay:200,tolerance:5}}),(0,C.MS)(C.AN,{activationConstraint:{distance:10}}));(0,i.useEffect)(()=>{const e=e=>{v(e.detail),b(!1)},s=()=>{const e=localStorage.getItem("ai_chat_ui_mode");e&&e!==g&&(v(e),b(!1))};return window.addEventListener("chatModeChanged",e),window.addEventListener("storage",s),()=>{window.removeEventListener("chatModeChanged",e),window.removeEventListener("storage",s)}},[g]);const k=(0,i.useCallback)(async()=>{if(d)try{const e=await(0,r.j)();h(e.data.tasks||e.data)}catch(e){console.error("Error loading tasks:",e),e.response&&403===e.response.status&&m()}},[d,m]);(0,i.useEffect)(()=>{k()},[k]);const f=async()=>{try{const e=await(0,r.j)(),s=e.data.tasks||e.data;return h(s),s}catch(e){console.error("Error refreshing tasks:",e)}},A=()=>{t("/tasks/new/edit")},T=e=>{t("/tasks/new/edit",{state:{task:e}})};if(!u)return(0,o.jsx)("div",{className:"container mt-5",children:(0,o.jsx)("div",{className:"task-container",children:(0,o.jsxs)("div",{className:"card-body p-3",children:[(0,o.jsxs)("div",{className:"d-flex flex-row justify-content-between align-items-center mb-3 header-container",children:[(0,o.jsx)("h2",{className:"card-title mb-0",children:"Your Tasks"}),(0,o.jsx)("div",{className:"d-flex gap-2 button-group",children:(0,o.jsxs)("button",{className:"btn btn-outline-".concat("dark"===s?"light":"dark"," d-flex align-items-center gap-2"),onClick:A,"aria-label":"Create new task",children:[(0,o.jsx)("i",{className:"bi bi-plus-circle","aria-hidden":"true"}),(0,o.jsx)("span",{className:"button-text",children:"New Task"})]})})]}),(0,o.jsx)("div",{className:"shimmer-list",children:Array.from({length:5}).map((e,s)=>(0,o.jsxs)("div",{className:"shimmer-task-item",children:[(0,o.jsx)("div",{className:"shimmer-task-header"}),(0,o.jsx)("div",{className:"shimmer-task-body"})]},s))})]})})});const D=[...u].sort((e,s)=>e.priority-s.priority),I=p?u.find(e=>e.id===p):null;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"container mt-5",children:(0,o.jsx)("div",{className:"task-container",children:(0,o.jsxs)("div",{className:"card-body p-3",children:[(0,o.jsxs)("div",{className:"d-flex flex-row justify-content-between align-items-center mb-3 header-container",children:[(0,o.jsx)("h2",{className:"card-title mb-0",children:"Your Tasks"}),(0,o.jsx)("div",{className:"d-flex gap-2 button-group",children:(0,o.jsxs)("button",{className:"btn btn-outline-".concat("dark"===s?"light":"dark"," d-flex align-items-center gap-2"),onClick:A,children:[(0,o.jsx)("i",{className:"bi bi-plus-circle"}),(0,o.jsx)("span",{className:"button-text",children:"New Task"})]})})]}),0===u.length?(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("i",{className:"bi bi-clipboard-check empty-state-icon"}),(0,o.jsx)("p",{className:"text-".concat("dark"===s?"light":"muted"," mb-2"),children:"No tasks yet"}),(0,o.jsx)("small",{className:"text-muted",children:"Create your first task or use AI Assistant to get started"})]}):(0,o.jsxs)(C.Mp,{sensors:N,collisionDetection:C.fp,onDragStart:e=>{j(e.active.id)},onDragEnd:async e=>{const{active:s,over:t}=e;j(null),t&&s.id!==t.id&&h(e=>{const i=e.findIndex(e=>e.id===s.id),n=e.findIndex(e=>e.id===t.id);if(-1===i||-1===n)return e;const c=(0,S.be)(e,i,n),l=c.map((e,s)=>{const t=s+1;return e.priority!==t?(0,r.vF)(e.id,t).catch(s=>{console.error("Error updating priority for task ".concat(e.id,":"),s)}):Promise.resolve()});return Promise.all(l),c.map((e,s)=>(0,a.A)((0,a.A)({},e),{},{priority:s+1}))})},onDragCancel:()=>{j(null)},children:[(0,o.jsx)(S.gB,{items:D.map(e=>e.id),strategy:S.kL,children:(0,o.jsx)("div",{className:"task-list",children:D.map(e=>(0,o.jsx)(E,{task:e,theme:s},e.id))})}),(0,o.jsx)(C.Hd,{adjustScale:!1,dropAnimation:{duration:300,easing:"cubic-bezier(0.25, 0.8, 0.25, 1)"},style:{cursor:"grabbing"},children:I?(0,o.jsx)("div",{style:{transform:"scale(1.03) rotate(2deg)",cursor:"grabbing",boxShadow:"0 12px 24px rgba(0, 0, 0, 0.25), 0 4px 8px rgba(0, 0, 0, 0.15)",borderRadius:"10px",transition:"all 150ms cubic-bezier(0.25, 0.8, 0.25, 1)"},children:(0,o.jsx)(l.A,{theme:s,task:I})}):null})]})]})})}),"drawer"===g&&(0,o.jsx)(y,{show:x,onClose:()=>b(!1),onTaskGenerated:T,theme:s,refreshTasks:f}),(0,o.jsx)(w,{theme:s,onTaskGenerated:T,refreshTasks:f})]})}}}]);
//# sourceMappingURL=929.b2880118.chunk.js.map