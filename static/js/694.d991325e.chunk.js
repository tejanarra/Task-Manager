"use strict";(self.webpackChunktask_manager_frontend=self.webpackChunktask_manager_frontend||[]).push([[694],{2891:()=>{},4505:(e,a,t)=>{t.d(a,{A7:()=>h,DY:()=>u,E$:()=>N,J2:()=>g,Lx:()=>m,Pr:()=>b,U0:()=>v,UT:()=>i,XL:()=>p,ec:()=>x,gQ:()=>y,iV:()=>n,j:()=>o,lC:()=>l,r7:()=>w,vF:()=>d,vq:()=>c,xw:()=>f});const s=t(9722).A.create({baseURL:"https://task-manager-sigma-ashen.vercel.app/api",headers:{"ngrok-skip-browser-warning":"true"},timeout:3e4});s.interceptors.request.use(e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization="Bearer ".concat(a)),e},e=>Promise.reject(e));const r=e=>{var a;return e.response?{message:(null===(a=e.response.data)||void 0===a?void 0:a.error)||"An error occurred",status:e.response.status}:e.request?{message:"No response from server. Please check your connection.",status:0}:{message:e.message||"An unexpected error occurred",status:-1}},o=()=>s.get("/tasks"),n=e=>s.get("/tasks/".concat(e)),i=e=>s.post("/tasks",e),l=(e,a)=>s.put("/tasks/".concat(e),a),c=e=>s.delete("/tasks/".concat(e)),d=(e,a)=>s.put("/tasks/".concat(e,"/priority"),{priority:a}),m=(e,a)=>s.post("/auth/login",{email:e,password:a}),p=async e=>s.post("/auth/google",{code:e}),u=(e,a,t,r)=>s.post("/auth/register",{firstName:e,lastName:a,email:t,password:r}),h=(e,a)=>s.post("/auth/verify-registration",{email:e,verificationCode:a}),g=e=>s.post("/auth/resend-verification",{email:e}),v=e=>s.post("/auth/forgot-password",{email:e}),f=(e,a,t)=>s.post("/auth/verify-code",{email:e,verificationCode:a,newPassword:t}),x=(e,a)=>s.post("/auth/change-password",{currentPassword:e,newPassword:a}),N=async()=>{try{return(await s.get("/profile")).data}catch(e){throw console.error("Error fetching profile:",e),e}},w=async e=>{try{return(await s.put("/profile",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){throw console.error("Error updating profile:",a),a}},b=async e=>{try{const a=Intl.DateTimeFormat().resolvedOptions().timeZone;return{success:!0,data:(await s.post("/ai/chat",{prompt:e},{headers:{"x-user-timezone":a}})).data}}catch(a){return{success:!1,error:r(a).message}}},y=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{const t=Intl.DateTimeFormat().resolvedOptions().timeZone;return{success:!0,data:(await s.post("/ai/chat-conversation",{message:e,conversationHistory:a},{headers:{"x-user-timezone":t}})).data}}catch(t){return{success:!1,error:r(t).message}}}},8694:(e,a,t)=>{t.r(a),t.d(a,{default:()=>d});var s=t(2555),r=t(5043),o=t(3216),n=t(4505),i=t(2205),l=t(8729),c=(t(2891),t(579));const d=()=>{const[e,a]=(0,r.useState)(null),[t,d]=(0,r.useState)(null),[m,p]=(0,r.useState)(null),[u,h]=(0,r.useState)(""),[g,v]=(0,r.useState)(""),[f,x]=(0,r.useState)({x:0,y:0}),[N,w]=(0,r.useState)(1),[b,y]=(0,r.useState)(0),[j,C]=(0,r.useState)(null),[k,S]=(0,r.useState)(!1),F=(0,o.Zp)(),{logout:P}=(0,l.A)();(0,r.useEffect)(()=>{(async()=>{try{const e=await(0,n.E$)();if(!e)throw new Error("Received no data");a(e)}catch(e){h("Failed to fetch profile data: ".concat(e.message||e.toString())),e&&403===e.status&&(P(),F("/login"))}})()},[P,F]);const E=(0,r.useCallback)((e,a)=>{C(a)},[]),I=async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=await(r=e,new Promise((e,a)=>{const t=new Image;t.addEventListener("load",()=>e(t)),t.addEventListener("error",e=>a(e)),t.setAttribute("crossOrigin","anonymous"),t.src=r}));var r;const o=document.createElement("canvas"),n=o.getContext("2d"),i=Math.max(s.width,s.height)/2*Math.sqrt(2)*2;o.width=i,o.height=i,n.translate(i/2,i/2),n.rotate(t*Math.PI/180),n.translate(-i/2,-i/2),n.drawImage(s,i/2-.5*s.width,i/2-.5*s.height);const l=n.getImageData(0,0,i,i);return o.width=a.width,o.height=a.height,n.putImageData(l,Math.round(0-i/2+.5*s.width-a.x),Math.round(0-i/2+.5*s.height-a.y)),new Promise(e=>{o.toBlob(a=>{e(a)},"image/jpeg")})},L=t=>{const{name:r,value:o}=t.target;e&&a((0,s.A)((0,s.A)({},e),{},{[r]:o}))},A=async t=>{t.append("firstName",e.firstName),t.append("lastName",e.lastName),t.append("phoneNumber",e.phoneNumber),t.append("dob",e.dob),t.append("bio",e.bio||"");try{const e=await(0,n.r7)(t);a(e.user),v("Profile updated successfully!");const s=JSON.parse(localStorage.getItem("userInfo"));s.avatar=e.user.avatar,localStorage.setItem("userInfo",JSON.stringify(s)),setTimeout(()=>F("/profile-overview"),2e3)}catch(s){h(s.message),setTimeout(()=>F("/profile-overview"),2e3)}finally{S(!1)}};return e||u?u?(0,c.jsxs)("div",{className:"profile-container flex-column",children:[(0,c.jsx)("h2",{className:"profile-title",children:"Edit Profile"}),u&&(0,c.jsx)("div",{className:"alert alert-danger",children:u})]}):(0,c.jsx)("div",{className:"profile-container",children:(0,c.jsxs)("div",{className:"profile-card shadow rounded",children:[(0,c.jsx)("h2",{className:"profile-title text-center mb-4",children:"Edit Profile"}),k&&(0,c.jsx)("div",{className:"loading-overlay",children:"Updating..."}),(0,c.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),!e)return void h("No profile data available.");S(!0);const s=new FormData;if(t&&j)try{const e=await I(m,j,b),a=new File([e],t.name,{type:"image/jpeg",lastModified:Date.now()});s.append("avatar",a),await A(s)}catch(u){h("Failed to crop image: "+u.message),S(!1)}else await A(s)},children:[t?(0,c.jsxs)("div",{className:"crop-container mb-4",children:[(0,c.jsx)("div",{className:"crop-area",style:{position:"relative",height:"400px"},children:(0,c.jsx)(i.Ay,{image:m,crop:f,zoom:N,rotation:b,aspect:1,cropShape:"round",showGrid:!1,onCropChange:x,onZoomChange:w,onRotationChange:y,onCropComplete:E})}),(0,c.jsxs)("div",{className:"image-controls mb-4 mt-3",children:[(0,c.jsxs)("div",{className:"control-group",children:[(0,c.jsx)("label",{htmlFor:"zoomRange",children:"Zoom:"}),(0,c.jsx)("input",{type:"range",id:"zoomRange",min:"1",max:"3",step:"0.1",value:N,onChange:e=>w(parseFloat(e.target.value))})]}),(0,c.jsxs)("div",{className:"control-group",children:[(0,c.jsx)("label",{htmlFor:"rotateRange",children:"Rotate:"}),(0,c.jsx)("input",{type:"range",id:"rotateRange",min:"0",max:"360",step:"1",value:b,onChange:e=>y(parseInt(e.target.value,10))})]}),(0,c.jsx)("button",{type:"button",className:"btn btn-secondary mt-2",onClick:()=>{d(null),p(null),x({x:0,y:0}),w(1),y(0)},children:"Cancel Crop"})]})]}):(0,c.jsxs)("div",{className:"text-center mb-4",children:[(0,c.jsx)("label",{htmlFor:"avatarUpload",className:"profile-image-preview",children:e.avatar?(0,c.jsx)("img",{src:e.avatar,alt:"Profile",className:"rounded-circle profile-image"}):(0,c.jsx)("div",{className:"placeholder-avatar",children:e?(0,c.jsxs)(c.Fragment,{children:[e.firstName&&e.firstName[0]?e.firstName[0].toUpperCase():"",e.lastName&&e.lastName[0]?e.lastName[0].toUpperCase():""]}):null})}),(0,c.jsx)("input",{type:"file",id:"avatarUpload",accept:"image/*",onChange:e=>{const a=e.target.files[0];if(a){d(a);const e=URL.createObjectURL(a);p(e),x({x:0,y:0}),w(1),y(0)}},className:"d-none"})]}),Object.entries({firstName:"First Name",lastName:"Last Name",phoneNumber:"Phone Number",dob:"Date of Birth",bio:"Bio"}).map(a=>{let[t,s]=a;return(0,c.jsxs)("div",{className:"form-group mb-3",children:[(0,c.jsx)("label",{htmlFor:t,className:"form-label",children:s}),"bio"===t?(0,c.jsx)("textarea",{className:"form-control",id:t,name:t,value:e[t]||"",onChange:L,placeholder:"Enter your ".concat(s.toLowerCase(),"..."),rows:"4"}):(0,c.jsx)("input",{type:"dob"===t?"date":"text",className:"form-control",id:t,name:t,value:e[t]||"",onChange:L,placeholder:"Enter your ".concat(s.toLowerCase(),"..."),required:"bio"!==t&&"phoneNumber"!==t})]},t)}),g&&(0,c.jsx)("div",{className:"alert alert-success",children:g}),(0,c.jsxs)("div",{className:"row mt-4",children:[(0,c.jsx)("div",{className:"col-12 col-md-6 mb-2 mb-md-0",children:(0,c.jsx)("button",{type:"button",className:"btn btn-secondary w-100",onClick:()=>F("/profile-overview"),disabled:k,children:"Cancel"})}),(0,c.jsx)("div",{className:"col-12 col-md-6",children:(0,c.jsx)("button",{type:"submit",className:"btn sign-in-btn w-100",disabled:k,children:"Save Changes"})})]})]})]})}):(0,c.jsxs)("div",{className:"profile-container",children:[(0,c.jsx)("div",{className:"loading-spinner",children:"Loading profile..."}),F("/login")]})}}}]);
//# sourceMappingURL=694.d991325e.chunk.js.map